<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Tool – Ultimate PDF Tools</title>

  <link rel="stylesheet" href="style.css" />

  <!-- pdf-lib -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

  <!-- pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>

<header class="hero small">
  <h1 id="toolName">PDF Tool</h1>
  <p id="toolDesc">Secure, browser-based PDF processing</p>
  <a href="index.html" class="back-link">← Back to Home</a>
</header>

<main class="tool-wrapper">

  <!-- ADD FILES -->
  <div style="text-align:center;">
    <input
      type="file"
      id="pdfFiles"
      hidden
      multiple
      accept="application/pdf,image/*"
    />
    <button id="addBtn" class="btn primary">
      ➕ Add Files
    </button>
  </div>

  <!-- TOOL INSTRUCTION (DYNAMIC) -->
  <p id="toolInstruction" class="status-text" style="margin-top:10px;">
    Upload your files to start.
  </p>

  <!-- DRAG & DROP -->
  <div id="dropZone" class="drop-zone">
    <strong id="dropText">Drag & Drop files here</strong><br />
    <small id="dropSubText">PDF or Images • No upload • Secure</small>
  </div>

  <!-- FILE LIST -->
  <div id="pdfList" class="pdf-list"></div>

  <!-- TOOL OPTIONS (ROTATE ONLY) -->
  <div id="toolOptions" style="margin-top:14px; text-align:center;"></div>

  <!-- PROGRESS -->
  <div class="progress-container" style="display:none;">
    <div id="progressBar"></div>
  </div>

  <!-- ACTION BUTTON -->
  <div style="text-align:center; margin-top:18px;">
    <button id="mergeBtn" class="btn primary">
      ▶ Start Processing
    </button>
  </div>

  <!-- DOWNLOAD -->
  <div class="download-area">
    <a
      id="downloadLink"
      class="btn success"
      style="display:none;"
      download
    >
      ⬇ Download Result
    </a>
  </div>

  <!-- STATUS -->
  <p id="status" class="status-text"></p>

</main>

<script>
/* ===== DYNAMIC TOOL UI (NO LOGIC CHANGE) ===== */
const params = new URLSearchParams(window.location.search);
const tool = params.get("tool") || "merge";

const instruction = document.getElementById("toolInstruction");
const dropText = document.getElementById("dropText");
const dropSubText = document.getElementById("dropSubText");
const toolOptions = document.getElementById("toolOptions");

if (tool === "rotate") {
  instruction.textContent = "Upload PDF files and choose rotation angle.";
  dropSubText.textContent = "Only PDF files are supported.";

  toolOptions.innerHTML = `
    <label style="font-size:14px;color:#475569;">
      Rotate pages by:
      <select id="rotationAngle" class="btn" style="margin-left:8px;min-height:42px;">
        <option value="90">90°</option>
        <option value="180">180°</option>
        <option value="270">270°</option>
      </select>
    </label>
  `;
}

if (tool === "pdf2jpg") {
  instruction.textContent = "Upload PDF files to convert pages into JPG images.";
  dropSubText.textContent = "Only PDF files are supported.";
}

if (tool === "jpg2pdf") {
  instruction.textContent = "Upload JPG or PNG images to create a PDF.";
  dropSubText.textContent = "Only image files are supported.";
}
</script>

<script>
// PDF to JPG logic (added code)
const files = [];
const statusDiv = document.getElementById("status");

addBtn.onclick = () => pdfFilesInput.click();

pdfFilesInput.onchange = (e) => {
  files.push(...e.target.files);
  updateFileList();
  pdfFilesInput.value = "";
};

dropZone.ondragover = (e) => {
  e.preventDefault();
  dropZone.classList.add("hover");
};

dropZone.ondragleave = () => dropZone.classList.remove("hover");

dropZone.ondrop = (e) => {
  e.preventDefault();
  dropZone.classList.remove("hover");
  files.push(...e.dataTransfer.files);
  updateFileList();
};

mergeBtn.onclick = async () => {
  if (tool === "pdf2jpg") {
    if (files.some(f => f.type !== "application/pdf")) {
      statusDiv.textContent = "❌ Please upload a PDF file only.";
      return;
    }

    const file = files[0];
    const pdfData = new Uint8Array(await file.arrayBuffer());

    const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;

    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({ scale: 2 });
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({ canvasContext: ctx, viewport }).promise;

      canvas.toBlob(blob => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `page-${i}.jpg`;
        a.click();
      }, "image/jpeg");
    }

    statusDiv.textContent = "✅ PDF converted to JPG images!";
  }
};
</script>

<script src="script.js"></script>
</body>
</html>
